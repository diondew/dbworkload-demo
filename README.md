# dbworkload-demo
This is a simple demo of dbworkload's sample data generation, Python stub generation and workload execution capabilities.

## Key Files

|  File|Description  |
|--|--|
|members.sql  |Membership list sample schema  |
|members.yaml  |Sample generated yaml |
|queries.sql  |Sample queries  |
|queries.py  |Workload Python source  |
|backup.py  |Stub workload Python source, generated by gen_stub |

## Generating Sample Files
dbworkload gives you the ability to generate a YAML file for the purposes of generating sample data for import into your database by passing in an existing schema definition.

For example, to create a YAML file from the members.sql schema for the purposes of creating test data, use the following command:

    dbworkload util yaml -i members.sql
Please use `dbworkload util yaml --help` to see all available options.

To continue generating sample files, execute the following command:

    dbworkload util csv -i members.yaml -x 1
Please use `dbworkload util csv --help` to see all available options

## Generating a Python Stub

dbworkload will generate a stub of Python code for executing your test workload by simply passing a file containing your SQL statements. Be sure to utilize placeholders in your queries to generate the best possible stub. This greatly simplifies the creation of required code to run a test using dbworkload.

Example of statement placeholders:

    INSERT INTO cc.members values (%s, %s, %s, %s, %s, %s, %s, %s);
In order to generate a Python stub, execute the following command. In this case, we will be passing backup.sql as our input.

    dbworkload util gen_stub -i backup.sql

## Executing the Members workload

For this simple example, I ran this workload using queries.py, which is the Python stub I generated and added the appropriate bind variables to perform the INSERT.

The following command executes the workload with 1 process for a duration of 60 seconds:

    dbworkload run -w queries.py --driver=postgres --uri="{YOUR CRDB CONNECTION STRING}" -x 1 -d 60
